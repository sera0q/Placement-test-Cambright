import { useState, useEffect } from "react";

export default function ExamScreen() {
    const [timeLeft, setTimeLeft] = useState(30 * 60); // 30 minutes
    const [warningShown, setWarningShown] = useState(false);
    const [isBlurred, setIsBlurred] = useState(false);

    useEffect(() => {
        // Block right-click
        const blockRightClick = (e) => e.preventDefault();
        document.addEventListener("contextmenu", blockRightClick);
        
        // Block keyboard shortcuts (Ctrl, Shift, Print Screen, etc.)
        const blockKeys = (e) => {
            if (e.key === "PrintScreen" || e.ctrlKey || e.shiftKey) {
                setIsBlurred(true);
                e.preventDefault();
            }
        };
        document.addEventListener("keydown", blockKeys);

        // Disable opening the exam more than once per device
        const hasAttempted = localStorage.getItem("examAttempted");
        if (hasAttempted) {
            alert("You have already taken this exam and cannot access it again.");
            window.location.href = "https://www.google.com"; // Redirect away
        }

        return () => {
            document.removeEventListener("contextmenu", blockRightClick);
            document.removeEventListener("keydown", blockKeys);
        };
    }, []);

    useEffect(() => {
        if (timeLeft > 0) {
            const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);
            if (timeLeft === 600 && !warningShown) {
                alert("You have 10 minutes remaining. Please complete the writing section before time runs out.");
                setWarningShown(true);
            }
            return () => clearTimeout(timer);
        } else {
            alert("Time is up! Your exam has been submitted automatically.");
            localStorage.setItem("examAttempted", "true");
            window.location.href = "https://www.google.com"; // Redirect to a submission page
        }
    }, [timeLeft]);

    return (
        <div className={`h-screen flex flex-col items-center justify-center bg-gray-900 text-white ${isBlurred ? "blur-lg" : ""}`}>
            <h1 className="text-3xl font-bold mb-4">English Placement Test</h1>
            <p className="mb-6">Our English Placement Test is designed to assess your current proficiency level and help us recommend the most suitable learning program for you.</p>
            <p className="text-xl font-bold">Time Left: {Math.floor(timeLeft / 60)}:{(timeLeft % 60).toString().padStart(2, "0")}</p>
            <button 
                className="mt-4 px-6 py-2 bg-blue-500 text-white text-lg rounded-lg hover:bg-blue-700"
                onClick={() => alert("Exam started. Do not try to take screenshots or switch windows!")}
            >
                Start Exam
            </button>
        </div>
    );
}
